<?
  isset($_GET['current_time']) ? $current_time = $_GET['current_time'] : $current_time = "";
  if ($current_time=="") $current_time=$global_begin_date.":00";  else $current_time=date_fr_to_en($current_time." 00:00:00");  $req_sql="SELECT * FROM orgas ORDER BY first_name, last_name";  $req_orgas = mysql_query($req_sql);  $current_time_en=substr($current_time,0,10);  $current_time=substr(date_en_to_fr($current_time),0,16);?>
  <SCRIPT language="Javascript">
  <!--
  function verify(){  var ok=1;  if (document.form.current_time.value=="")  {    alert("Tu dois donner une heure de recherche");    ok=0;  }  else if ((document.form.current_time.value.length!=16) || (document.form.current_time.value.charAt(2)!="-") || (document.form.current_time.value.charAt(5)!="-") || (document.form.current_time.value.charAt(10)!=" ") || (document.form.current_time.value.charAt(13)!=":"))  {    alert("Tu dois une heure de recherche dans le bon format (jj-mm-aaaa hh:mm)");    ok=0;  }  if (ok==1) document.form.submit();}
  -->
  </SCRIPT>
  <TABLE width="1%" cellspacing="0" cellpadding="3">  <FORM method="POST" name="form" action="main.php?file=orgas&action=time">    <TR>       <TD colspan="4">&nbsp;</TD>    </TR>    <TR class="orgas_top">       <TD colspan="4" nowrap> <B>Choisis une heure (jj-mm-aaaa hh:mm)</B>&nbsp;&nbsp;&nbsp;         <INPUT type="text" name="current_time" value="<? print($current_time); ?>" size="20" maxlength="40">        <INPUT type="button" value="Go" onClick="verify()">      </TD>    </TR>    <TR class="orgas_top">       <TD colspan="2" nowrap> <B>Liste des orgas</B> </TD>      <TD align="center"> <B>Horaires</B> </TD>    </TR>    <?  $orgas_array=result_orgas($req_orgas);  for ($i=0;$i<count($orgas_array);$i++)  {$plages_orga=$orgas_array[$i]->plages;$list_plages_orga=explode("|",$plages_orga);sort($list_plages_orga);array_splice($list_plages_orga,0,2);	$orga_in_plage_tache=false;for ($j=0;$j<count($list_plages_orga);$j++){  if (($current_time_en>=substr($list_plages_orga[$j],0,10)) && ($current_time_en<=substr($list_plages_orga[$j],17,10)))  {	$orga_in_plage_tache=true;	break;  }}if ($orga_in_plage_tache){?>    <TR class="orgas">       <TD width="1%">&nbsp;&nbsp;&nbsp;</TD>      <TD valign="top" nowrap> <A href="main.php?file=plannings&action=edit&id_orga=<? print($orgas_array[$i]->id_orga); ?>" class="lien"><? print($orgas_array[$i]->first_name." ".$orgas_array[$i]->last_name); ?></A>       </TD>      <TD align="center" nowrap><?    $list_plages="";    for ($j=0;$j<count($list_plages_orga);$j++)	{      if (($current_time_en>=substr($list_plages_orga[$j],0,10)) && ($current_time_en<=substr($list_plages_orga[$j],17,10)))	  {	    if ($list_plages!="") $list_plages=$list_plages."<BR>";	    $list_plages=$list_plages.list_to_begin_plage($list_plages_orga[$j])." à ".list_to_end_plage($list_plages_orga[$j]);	  }    }	print($list_plages);?>	  </TD>    </TR>    <?  }}?>  </FORM></TABLE>