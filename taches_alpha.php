<?
  isset($_GET['id_categorie']) ? $id_categorie = $_GET['id_categorie'] : $id_categorie = ""; 
    $req_sql="SELECT * FROM categories WHERE type_categorie='tache' ORDER BY nom_categorie"; $req_categories = mysql_query($req_sql);   $req_sql="SELECT * FROM orgas ORDER BY first_name, last_name"; $req_orgas = mysql_query($req_sql);  ?><SCRIPT language="JavaScript">function verif(id){  if (confirm('Es-tu sûr de vouloir supprimer cette tâche ?'))  {    document.form_suppr.id_tache.value=id;	document.form_suppr.submit();  }}</SCRIPT><TABLE WIDTH="1%" CELLSPACING="0" CELLPADDING="3">  <TR>    <TD colspan="8" align="center"><? $req_sql="SELECT taches.* FROM taches, lieux WHERE taches.id_lieu='0' ORDER BY taches.titre";  $req = mysql_query($req_sql);  $taches_array=result_taches($req);  if(count($taches_array)>0)print(count($taches_array)." tâches sans lieu + ");  if ($id_categorie!=""){		$req_sql="SELECT taches.*, lieux.nom_lieu FROM taches, lieux WHERE taches.id_lieu=lieux.id_lieu AND taches.id_categorie='".$id_categorie."' ORDER BY taches.titre";}		else{		if ($jour!=""){		$req_sql="SELECT taches.*, lieux.nom_lieu FROM taches, lieux WHERE taches.id_lieu=lieux.id_lieu ORDER BY taches.begin_time";}				else{$req_sql="SELECT taches.*, lieux.nom_lieu FROM taches, lieux WHERE taches.id_lieu=lieux.id_lieu ORDER BY taches.titre";}		}  	$req = mysql_query($req_sql);	 $taches_array=result_taches($req);	 print(count($taches_array)." tâches");  ?>  &nbsp;</TD>  </TR>  <TR valign="middle" CLASS="taches_top" >    <td></td>	<TD valign="middle">       <B><A href="<? print($file."_print.php");?>" target="_blank" class="menu"><img src="images/print.jpg"></A></B>     &nbsp;&nbsp;&nbsp;<B><A href="<? print($file."_print.php");?>?resp=1" target="_blank" class="menu"><img src="images/print.jpg"></A>RESP</B><TD style="border:1px dotted black">Rechercher : <form action="main.php?file=taches&action=alpha" name="rech" method="post"><input name="recherche" type="text"><input name="valid" type="submit" value="OK" onClick="valid()"><br>Rechercher aussi dans consigne <input type="checkbox" name="et"></form>	  </TD>    <td><a href="main.php?file=taches&action=alpha&jour=ok">liste des tâches       par jour</a><br>    </td>    <td colspan="5" style="border:1px dotted black"> <b>selctionner       par cat&eacute;gories</b><br>	  <a href="main.php?file=taches&action=alpha" class="lien">TOUTES</a>      <?  $categories_array=result_categories($req_categories);  for ($i=0;$i<count($categories_array);$i++)  {?>  &nbsp;-&nbsp;<a href="main.php?file=taches&action=alpha&id_categorie=<? print($categories_array[$i]->id_categorie); ?> " class="lien"><? print($categories_array[$i]->nom);?></a>      <?  }?>      </TD>  </TR>  <TR CLASS="taches_top">    <TD COLSPAN="2" nowrap>      <B>Liste des t&acirc;ches</B>    </TD>    <TD ALIGN="center">      <B>Horaires</B>    </TD>    <TD ALIGN="center">      <B>Lieu</B>    </TD>    <TD ALIGN="center">      <B>Responsable</B>    </TD>    <TD ALIGN="center"> <B>Planning</B> </TD>    <TD ALIGN="center">      <B>Supprimer</B>    </TD>  </TR><?  $orgas_array=result_orgas($req_orgas);  for ($i=0;$i<count($taches_array);$i++)  {  if (($recherche!="" && stristr($taches_array[$i]->titre, $recherche)!=false) ||($recherche!="" && stristr($taches_array[$i]->consigne, $recherche)!=false && $et=="on") || ($recherche=="")){    $fournisseur="";    $resp="";    if ($taches_array[$i]->id_resp==0) $resp="personne";    else    {      for ($j=0;$j<count($orgas_array);$j++)      {        if ($orgas_array[$j]->id_orga==$taches_array[$i]->id_resp)        {          $resp=$orgas_array[$j]->first_name." ".$orgas_array[$j]->last_name;          break;        }      }    }?>  <TR valign="top" CLASS="taches" onMouseOver="this.className='over'" onMouseOut="this.className='taches'">     <TD width="1%">&nbsp;&nbsp;&nbsp;</TD>    <TD nowrap> <A HREF="main.php?file=taches&action=modify&id_tache=<? print($taches_array[$i]->id_tache); ?>" CLASS="lien"><? print($taches_array[$i]->titre); ?></A>     </TD>    <TD nowrap>       <?    $list_plages=explode("|",$taches_array[$i]->plages);	$nb_plages=count($list_plages)-2;    for ($j=0;$j<$nb_plages;$j++)	{	  if ($j!=0) print("<BR>");	  print(list_to_begin_plage($list_plages[$j+1])." à ".list_to_end_plage($list_plages[$j+1]));    }?>    </TD>    <TD nowrap> <? print($taches_array[$i]->nom_lieu); ?> </TD>    <TD nowrap> <? print($resp); ?> </TD>    <TD WIDTH="1%" ALIGN="center"> <A HREF="main.php?file=orgas&action=tache&id_tache=<? print($taches_array[$i]->id_tache); ?>" CLASS="lien">[Planning]</A>     </TD>	    <TD WIDTH="1%" ALIGN="center"> <? if ($session_user_type!="soft")    {?><A HREF="javascript:verif(<? print($taches_array[$i]->id_tache); ?>)" CLASS="lien">[Supprimer]</A><? } ?>     </TD>  </TR><?  }}  $req_sql="SELECT taches.* FROM taches, lieux WHERE taches.id_lieu='0' ORDER BY taches.titre";  $req = mysql_query($req_sql);  $taches_array=result_taches($req);  for ($i=0;$i<count($taches_array);$i++)  {  if (($recherche!="" && stristr($taches_array[$i]->titre, $recherche)!=false) ||($recherche!="" && stristr($taches_array[$i]->consigne, $recherche)!=false && $et=="on") || ($recherche=="")){    $resp="";    if ($taches_array[$i]->id_resp==0) $resp="personne";    else    {      for ($j=0;$j<count($orgas_array);$j++)      {        if ($orgas_array[$j]->id_orga==$taches_array[$i]->id_resp)        {          $resp=$orgas_array[$j]->first_name." ".$orgas_array[$j]->last_name;          break;        }      }    }    if ($i==0)	{?>  <TR CLASS="taches">    <TD colspan="8"><HR width="75%"></TD>  </TR><?    }?>  <TR valign="top" CLASS="taches">     <TD width="1%">&nbsp;&nbsp;&nbsp;</TD>    <TD nowrap> <A HREF="main.php?file=taches&action=modify&id_tache=<? print($taches_array[$i]->id_tache); ?>" CLASS="lien"><? print($taches_array[$i]->titre); ?></A>     </TD>    <TD nowrap>       <?    $list_plages=explode("|",$taches_array[$i]->plages);	$nb_plages=count($list_plages)-2;    for ($j=0;$j<$nb_plages;$j++)	{	  if ($j!=0) print("<BR>");	  print(list_to_begin_plage($list_plages[$j+1])." à ".list_to_end_plage($list_plages[$j+1]));    }?>    </TD>    <TD nowrap> A d&eacute;finir </TD>    <TD nowrap> <? print($resp); ?> </TD>    <TD WIDTH="1%" ALIGN="center"> <A HREF="main.php?file=orgas&action=tache&id_tache=<? print($taches_array[$i]->id_tache); ?>" CLASS="lien">Go</A>     </TD>	    <TD WIDTH="1%" ALIGN="center"><? if ($session_user_type!="soft")    {?> <A HREF="javascript:verif(<? print($taches_array[$i]->id_tache); ?>)" CLASS="lien">Go</A><? } ?>     </TD>  </TR><?  }}?></TABLE><FORM name="form_suppr" action="db_action.php?db_action=delete_tache" method="post"><INPUT name="id_tache" type="hidden"></FORM>